
///////////////////////////////////////////////////////////////////////////////
//  Scoreboard                                                               //
///////////////////////////////////////////////////////////////////////////////

.scoreboard.aesir = [
	local bar score bit cc cell0 cell1 cell2 cell3 cell4 cell5

	bar = [ ? (& $bit $arg1) [ UIbar 0 1 0 0 0xB0284890 ] ]
	score = (at "0 star star flag star crown crown star" $getmode)

	if $getmode       [ bit = (^ $bit 0x01) ; ++ cc ]
	if $showkills     [ bit = (^ $bit 0x02) ; ++ cc ]
	if $showdeaths    [ bit = (^ $bit 0x04) ; ++ cc ]
	if $scoreboardmultiplayer [
		if $showpj    [ bit = (^ $bit 0x08) ; ++ cc ]
		if $showping  [ bit = (^ $bit 0x10) ; ++ cc ]
	]
	if $showclientnum [ bit = (^ $bit 0x20) ; ++ cc ]

	//    name cell size   +   cell size * cc   +   cell spacing * cc
	x = (+f $.UI_pad_UXS (*f $.UI_pad_6XL $cc) (*f $.UI_pad_3XL $cc))

	cell0 = (? (& $bit 0x1) [
		uifill $.UI_pad_6XL 0 [ uitext (getclientscore $cn) 0.6 ]
	])
	cell1 = (if (& $bit 0x2) [ result [
		@(bar 0x1)
		uifill $.UI_pad_6XL 0 [ uitext (getclientfrags $cn) 0.6 ]
	]])
	cell2 = (if (& $bit 0x4) [ result [
		@(bar 0x3)
		uifill $.UI_pad_6XL 0 [ uitext (getclientdeaths $cn) 0.6 ]
	]])
	cell3 = (if (& $bit 0x8) [ result [
		@(bar 0x7)
		uifill $.UI_pad_6XL 0 [
			if (scoreboardpj $cn) [
				uitext (scoreboardpj $cn) 0.6
			] [ uifonttext "wide" "^f4-" 0.6 ]
		]
	]])
	cell4 = (if (& $bit 0x10) [ result [
		@(bar 0xF)
		uifill $.UI_pad_6XL 0 [
			if (scoreboardping $cn) [
				uitext (scoreboardping $cn) 0.6
			] [ uifonttext "wide" "^f4-" 0.6 ]
		]
	]])
	cell5 = (if (& $bit 0x20) [ result [
		@(bar 0x1F)
		uifill $.UI_pad_6XL 0 [ uitext $cn 0.6 ]
	]])

	uigroup [
		uialign -2 -1
		uifill 0 (*f $.UI_pad_5XL 3)
		uioffset 0 (!f $.UI_pad_4XL) [
			uialign -1 -1
			uispace $.UI_pad_2XL 0 [
				uifontcolortext "wide_outline" (getteamname 1) 0x60FFFFFF 1.4
			]
		]
		uivlist 0 [
			uifill $x $.UI_pad_5XL [
				if (numscoreboard 1) [
					uispace $.UI_pad_M 0 [
						uialign 1
						uihlist $.UI_pad_3XL [ loop n 6 [
								if (& $bit (<< 1 $n)) [
									n = (at [@@@score frag death pj ping cn] $n)
									uifill $.UI_pad_6XL 0 [
										UIfastimg "ui/" "scoreboard/" $n $.UI_pad_3XL
									]
								]
						] ]
					]
				]
			]
			loopscoreboard cn 1 [
				uicolor 0xB0203070 $x $.UI_pad_5XL [
					style_generic_gradient2
					UIfastimgtile "ui/" "ui_bg" 0
					uioutline 0xB0284890
					uispace $.UI_pad_M 0 [
						uicolortext (getclientcolorname $cn) (scoreboardstatus $cn) 0.6
						uialign- -1
						uihlist $.UI_pad_L [
							uiclamp.y
							uialign 1
							loop n 6 [ do [cell@n] ]
						]
					]
					uiclamp*e
				]
			]
			uifill 0 $.UI_pad_5XL
		]
	]
]

.scoreboard.vanir = [
	local bar score bit cc cell0 cell1 cell2 cell3 cell4 cell5

	bar = [ ? (& $bit $arg1) [ UIbar 0 1 0 0 0xB0842828 ] ]
	score = (at "0 star star flag star crown crown star" $getmode)

	if $getmode       [ bit = (^ $bit 0x01) ; ++ cc ]
	if $showkills     [ bit = (^ $bit 0x02) ; ++ cc ]
	if $showdeaths    [ bit = (^ $bit 0x04) ; ++ cc ]
	if $scoreboardmultiplayer [
		if $showpj    [ bit = (^ $bit 0x08) ; ++ cc ]
		if $showping  [ bit = (^ $bit 0x10) ; ++ cc ]
	]
	if $showclientnum [ bit = (^ $bit 0x20) ; ++ cc ]

	//    name cell size   +   cell size * cc   +   cell spacing * cc
	x = (+f $.UI_pad_UXS (*f $.UI_pad_6XL $cc) (*f $.UI_pad_3XL $cc))

	cell0 = (? (& $bit 0x1) [
		uifill $.UI_pad_6XL 0 [ uitext (getclientscore $cn) 0.6 ]
	])
	cell1 = (if (& $bit 0x2) [ result [
		uifill $.UI_pad_6XL 0 [ uitext (getclientfrags $cn) 0.6 ]
		@(bar 0x1)
	]])
	cell2 = (if (& $bit 0x4) [ result [
		uifill $.UI_pad_6XL 0 [ uitext (getclientdeaths $cn) 0.6 ]
		@(bar 0x3)
	]])
	cell3 = (if (& $bit 0x8) [ result [
		uifill $.UI_pad_6XL 0 [
			if (scoreboardpj $cn) [
				uitext (scoreboardpj $cn) 0.6
			] [ uifonttext "wide" "^f4-" 0.6 ]
		]
		@(bar 0x7)
	]])
	cell4 = (if (& $bit 0x10) [ result [
		uifill $.UI_pad_6XL 0 [
			if (scoreboardping $cn) [
				uitext (scoreboardping $cn) 0.6
			] [ uifonttext "wide" "^f4-" 0.6 ]
		]
		@(bar 0xF)
	]])
	cell5 = (if (& $bit 0x20) [ result [
		uifill $.UI_pad_6XL 0 [ uitext $cn 0.6 ]
		@(bar 0x1F)
	]])

	uigroup [
		uialign -2 -1
		uifill 0 (*f $.UI_pad_5XL 3)
		uioffset 0 (!f $.UI_pad_4XL) [
			uialign 1 -1
			uispace $.UI_pad_2XL 0 [
				uifontcolortext "wide_outline" (getteamname 2) 0x60FFFFFF 1.4
			]
		]
		uivlist 0 [
			uifill $x $.UI_pad_5XL [
				if (numscoreboard 2) [
					uispace $.UI_pad_M 0 [
						uialign -1
						uihlist $.UI_pad_3XL [ loop+* n 5 -1 6 [
								if (& $bit (<< 1 $n)) [
									n = (at [@@@score frag death pj ping cn] $n)
									uifill $.UI_pad_6XL 0 [
										UIfastimg "ui/" "scoreboard/" $n $.UI_pad_3XL
									]
								]
						] ]
					]
				]
			]
			loopscoreboard cn 2 [
				uicolor 0xB0702020 $x $.UI_pad_5XL [
					style_generic_gradient2
					UIfastimgtile "ui/" "ui_bg" 1
					uioutline 0xB0842828
					uispace $.UI_pad_M 0 [
						uihlist $.UI_pad_L [
							uiclamp.y
							uialign -1
							loop+* n 5 -1 6 [ do [cell@n] ]
						]
						uicolortext (getclientcolorname $cn) (scoreboardstatus $cn) 0.6
						uialign- 1
					]
					uiclamp*e
				]
			]
			uifill 0 $.UI_pad_5XL
		]
	]
]

.scoreboard.ffa = [
	local bar score bit cc cell0 cell1 cell2 cell3 cell4 cell5

	bar = [ ? (& $bit $arg1) [ UIbar 0 1 0 0 0xB0404040 ] ]
	score = (at "0 star star flag star crown crown star" $getmode)

	if $getmode       [ bit = (^ $bit 0x01) ; ++ cc ]
	if $showkills     [ bit = (^ $bit 0x02) ; ++ cc ]
	if $showdeaths    [ bit = (^ $bit 0x04) ; ++ cc ]
	if $scoreboardmultiplayer [
		if $showpj    [ bit = (^ $bit 0x08) ; ++ cc ]
		if $showping  [ bit = (^ $bit 0x10) ; ++ cc ]
	]
	if $showclientnum [ bit = (^ $bit 0x20) ; ++ cc ]

	//    name cell size   +   cell size * cc   +   cell spacing * cc
	x = (+f $.UI_pad_UXS (*f $.UI_pad_6XL $cc) (*f $.UI_pad_3XL $cc))

	cell0 = (? (& $bit 0x1) [
		uifill $.UI_pad_6XL 0 [ uitext (getclientscore $cn) 0.6 ]
	])
	cell1 = (if (& $bit 0x2) [ result [
		@(bar 0x1)
		uifill $.UI_pad_6XL 0 [ uitext (getclientfrags $cn) 0.6 ]
	]])
	cell2 = (if (& $bit 0x4) [ result [
		@(bar 0x3)
		uifill $.UI_pad_6XL 0 [ uitext (getclientdeaths $cn) 0.6 ]
	]])
	cell3 = (if (& $bit 0x8) [ result [
		@(bar 0x7)
		uifill $.UI_pad_6XL 0 [
			if (scoreboardpj $cn) [
				uitext (scoreboardpj $cn) 0.6
			] [ uifonttext "wide" "^f4-" 0.6 ]
		]
	]])
	cell4 = (if (& $bit 0x10) [ result [
		@(bar 0xF)
		uifill $.UI_pad_6XL 0 [
			if (scoreboardping $cn) [
				uitext (scoreboardping $cn) 0.6
			] [ uifonttext "wide" "^f4-" 0.6 ]
		]
	]])
	cell5 = (if (& $bit 0x20) [ result [
		@(bar 0x1F)
		uifill $.UI_pad_6XL 0 [ uitext $cn 0.6 ]
	]])

	uigrid 2 $.UI_pad_DM 0 [
		loop n 2 [
			uifill $x $.UI_pad_5XL [
				if (> (numscoreboard 0) $n) [
					uispace $.UI_pad_M 0 [
						uialign 1
						uihlist $.UI_pad_3XL [ loop n 6 [
							if (& $bit (<< 1 $n)) [
								n = (at [@@@score frag death pj ping cn] $n)
								uifill $.UI_pad_6XL 0 [
									UIfastimg "ui/" "scoreboard/" $n $.UI_pad_3XL
								]
							]
						] ]
					]
				]
			]
		]
		loopscoreboard cn 0 [
			uicolor 0xB0303030 $x $.UI_pad_5XL [
				style_generic_gradient2
				UIfastimgtile "ui/" "ui_bg" 0
				uioutline 0xB0404040
				uispace $.UI_pad_M 0 [
					uicolortext (getclientcolorname $cn) (scoreboardstatus $cn) 0.6
					uialign- -1
					uihlist $.UI_pad_L [
						uiclamp.y
						uialign 1
						loop n 6 [ do [cell@n] ]
					]
				]
				uiclamp*e
			]
		]
		loop n 2 [ uifill 0 $.UI_pad_5XL ]
	]
]

.scoreboard.spec = [
	if $scoreboardshowclientnum [ arg1 = $.UI_pad_DS ]
	arg1 = (+f $arg1 $.UI_pad_UXS)

	uigrid 3 $.UI_pad_L 0 [
		loopscoreboard cn -1 [
			uicolor 0xB0303840 $arg1 $.UI_pad_5XL [
				style_generic_gradient2
				UIfastimgtile "ui/" "ui_bg" 0
				uioutline 0xB0404860
				uispace $.UI_pad_M 0 [
					uicolortext (getclientcolorname $cn) (scoreboardstatus $cn) 0.6
					uialign- -1
					@@@(? $scoreboardshowclientnum [
						uifill $.UI_pad_6XL 0 [
							uialign 1
							uitext $cn 0.6
						]
					])
				]
				uiclamp*e
			]
		]
	]
]

UIquickdialog "scoreboard" [
	uiallowinput 0
	refreshscoreboard
	uiclamp.e
] [
	// uicolortext (getteamscore 1) $_c_blue2 1.5
	uivlist 0 [
		uialign 0 -1
		if (m_timed $getmode) [
			uihlist $.UI_pad_MS [
				local hue ; hue = (? (|| $intermission $paused) $c_orange $c_white)
				// var scoreboardtime otherwise
				uifontcolortext "mono"       (div $timeremaining 60)    $hue 1.2
				uifontcolortext "wide" ":"                              $hue 1.2
				uifontcolortext "mono" (pad0 (mod $timeremaining 60) 2) $hue 1.2
			]
		] [ uitext " " 1.2 ]
		uifill 0 $.UI_pad_5XL
		uigroup [
			uifill 0 (*f $.UI_pad_5XL 3)
			if (m_teammode $getmode) [
				uifont "wide_outline" [
					uioffset (!f $.UI_pad_2XL) (!f $.UI_pad_2XL) [ uitext "V" 1 ]
					uioffset     $.UI_pad_2XL      $.UI_pad_2XL  [ uitext "S" 1 ]
				]
				uihlist $.UI_pad_DM [
					.scoreboard.aesir
					.scoreboard.vanir
				]
			] [
				uifont "wide_outline" [
					uioffset (!f $.UI_pad_2XL) (!f $.UI_pad_3XL) [ uitext "F" 0.6 ]
					uitext "F" 0.6
					uioffset     $.UI_pad_2XL      $.UI_pad_3XL  [ uitext "A" 0.6 ]
				]
				.scoreboard.ffa
			]
		]
		.scoreboard.spec
	]
	uigroup [
		uialign 0 1
		uifonttext "wide_outline" (? $scoreboardmap $scoreboardmap) 1
	]
	uigroup [
		uialign 1 1
		uicolortext $scoreboardservinfo 0x48FFFFFF 0.7
	]
] [
	UIsetbgblur 1
	.hidehud $hidehud
	hidehud 1
] [
	UIsetbgblur -1
	hidehud $.hidehud
]
